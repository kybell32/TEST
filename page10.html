<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì†Œì…œ ë¯¸ë””ì–´ ì—°êµ¬_p6 </title>
<style>
  :root{--line:#e5e7eb;--pri:#2563eb;--bg:#f6f7f9;--muted:#6b7280}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;color:#111827;line-height:1.6}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:12px;text-align:center;font-weight:700}
  main{max-width:880px;margin:0 auto;padding:18px}
  h1{font-size:20px;margin:6px 0 18px}
  .card{background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.04);padding:16px;margin:14px 0}
  .qtitle{font-weight:700;margin-bottom:8px}
  .help{font-size:12px;color:var(--muted);margin-bottom:8px}

  /* ìŠ¤ì¼€ì¼: í•œ ì¤„ ìœ ì§€ + í•„ìš” ì‹œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
  .scale{
    display:flex; flex-wrap:nowrap; gap:8px;
    overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:none;
  }
  .scale::-webkit-scrollbar{ display:none; }

  /* ì¹©(ë¸”ëŸ­) */
  label.chip{
    position:relative; display:inline-flex; align-items:center;
    border:1px solid var(--line); border-radius:999px;
    padding:8px 10px; background:#fff; cursor:pointer; user-select:none;
    white-space:nowrap; line-height:1; transition:background .15s, border-color .15s, box-shadow .15s;
    font-size:14px;
  }
  /* ë¼ë””ì˜¤ëŠ” ë³´ì´ì§€ ì•Šê²Œ(ì ‘ê·¼ì„± ìœ ì§€: ì „ì²´ ì¹© í´ë¦­) */
  label.chip > input{
    position:absolute; inset:0; opacity:0; width:100%; height:100%; margin:0; cursor:pointer;
  }
  label.chip strong{ font-variant-numeric:tabular-nums; font-weight:700 }
  label.chip:hover{ background:#f9fafb }
  label.chip:focus-within{ box-shadow:0 0 0 3px rgba(37,99,235,.2) }

  /* ì„ íƒ ìƒíƒœ */
  label.chip.selected{
    background:#eef2ff;
    border-color:#93c5fd;
    box-shadow:inset 0 0 0 2px #2563eb;
  }
  label.chip.selected strong{ color:#1d4ed8 }

  .btn-area{text-align:center;margin-top:24px}
  .btn{border:none;border-radius:10px;padding:12px 20px;font-size:16px;background:var(--pri);color:#fff;font-weight:600;cursor:pointer}
  .btn:disabled{opacity:.5;cursor:not-allowed}

  @media (max-width:480px){
    main{padding:12px}
    .card{padding:12px}
    .scale{gap:6px}
    label.chip{padding:8px 9px;font-size:13.5px}
  }
</style>
</head>
<body>
<header>ì„¤ë¬¸ ë‹¨ê³„</header>
<main>
  <h1>ì•„ë˜ ë¬¸í•­ì— ì‘ë‹µí•´ ì£¼ì„¸ìš”. ëª¨ë“  ë¬¸í•­ì— ì‘ë‹µí•´ì•¼ ë‹¤ìŒìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</h1>

  <!-- ì„¹ì…˜ 1: ì„¤ë“/ìˆ˜ìš© ê´€ë ¨ (3ë¬¸í•­) -->
  <section class="card">
    <div class="qtitle">ì•ì„œ ë³¸ ì˜¨ë¼ì¸ ê²Œì‹œë¬¼ì˜ ì˜ê²¬ì— ëŒ€í•´ ì–´ë–»ê²Œ ìƒê°í•˜ì‹­ë‹ˆê¹Œ?</div>
    <div class="help">1(ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤) ~ 7(ë§¤ìš° ê·¸ë ‡ë‹¤).</div>

    <div class="card">
      <div class="qtitle">1) ì˜ê²¬ì— ê²°ì½” ë™ì˜í•  ìˆ˜ ì—†ë‹¤.</div>
      <div class="scale" data-name="s1_q1" data-qkey="P9_S1_Q1"></div>
    </div>

    <div class="card">
      <div class="qtitle">2) ì˜ê²¬ì— í—ˆì ì´ ìˆë‹¤ê³  ìƒê°í•œë‹¤.</div>
      <div class="scale" data-name="s1_q2" data-qkey="P9_S1_Q2"></div>
    </div>

    <div class="card">
      <div class="qtitle">3) ì˜ê²¬ì„ ì‰½ê²Œ ë°›ì•„ë“¤ì˜€ë‹¤.</div>
      <div class="scale" data-name="s1_q3" data-qkey="P9_S1_Q3"></div>
    </div>
  </section>

  <!-- ì„¹ì…˜ 2: ê³µê²©/ì°¨ë³„/í˜ì˜¤ ì¸ì‹ (3ë¬¸í•­) -->
  <section class="card">
    <div class="qtitle">ì•ì„œ ë³¸ ê²Œì‹œë¬¼ì´ íŠ¹ì • ì§‘ë‹¨ì— ëŒ€í•´ ì–´ë–»ê²Œ ë°œì–¸í•œë‹¤ê³  ë³´ì‹­ë‹ˆê¹Œ?</div>
    <div class="help">1(ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤) ~ 7(ë§¤ìš° ê·¸ë ‡ë‹¤)</div>

    <div class="card">
      <div class="qtitle">4) ê³µê²©ì ì¸ ë°œì–¸ì„ í•˜ê³  ìˆë‹¤.</div>
      <div class="scale" data-name="s2_q1" data-qkey="P9_S2_Q1"></div>
    </div>

    <div class="card">
      <div class="qtitle">5) ì°¨ë³„ì ì¸ ë°œì–¸ì„ í•˜ê³  ìˆë‹¤.</div>
      <div class="scale" data-name="s2_q2" data-qkey="P9_S2_Q2"></div>
    </div>

    <div class="card">
      <div class="qtitle">6) í˜ì˜¤ì ì¸ ë°œì–¸ì„ í•˜ê³  ìˆë‹¤.</div>
      <div class="scale" data-name="s2_q3" data-qkey="P9_S2_Q3"></div>
    </div>
  </section>

  <div class="btn-area">
    <button id="nextBtn" class="btn" disabled>ë‹¤ìŒ</button>
  </div>
</main>

<script type="module">
/***** â–¼ Firebase ì´ˆê¸° ì„¤ì • â–¼ *****/
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCEZEZItyfBTMg8tVWv3RQX19r6R-71pME",
  authDomain: "to-be-a-master.firebaseapp.com",
  projectId: "to-be-a-master",
  storageBucket: "to-be-a-master.firebasestorage.app",
  messagingSenderId: "223906864735",
  appId: "1:223906864735:web:a04b3fdfa88e48a99905ea",
  measurementId: "G-SXF1BMH4DB"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
/***** â–² Firebase ì„¤ì • ë â–²*/

const PAGE = 10;               // í˜ì´ì§€ ë²ˆí˜¸
const NEXT_PAGE_URL = "page11.html"; // ë‹¤ìŒ í˜ì´ì§€
const DISPLAY_MS = 30000;        // 30ì´ˆ ì˜ˆì‹œ
const STIM_KEY = "P9_POST_1";    // ë¶„ì„ìš© ì‹ë³„ì

const text = `ë§ˆì§€ë§‰ ìê·¹ í…ìŠ¤íŠ¸ ì˜ˆì‹œì…ë‹ˆë‹¤.
ì—¬ê¸° ë‚´ìš©ì„ í˜ì´ì§€ì— ë³´ì—¬ì£¼ê³  ì‚¬ìš©ìì˜ ë°˜ì‘ì„ Firestoreì— ê¸°ë¡í•©ë‹ˆë‹¤.`;

// DOM ì™„ì „íˆ ë¡œë“œ í›„ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', () => {

  // 1ï¸âƒ£ ë¬¸í•­ ìˆ«ì ë²„íŠ¼ ìƒì„±
  document.querySelectorAll('.scale').forEach(scale => {
    for(let i=1; i<=7; i++){
      const label = document.createElement('label');
      label.className = 'chip';
      label.innerHTML = `<strong>${i}</strong><input type="radio" name="${scale.dataset.name}" value="${i}">`;
      label.querySelector('input').addEventListener('change', checkAllAnswered);
      scale.appendChild(label);
    }
  });

  // 2ï¸âƒ£ ì„ íƒ ì²´í¬ & ë‹¤ìŒ ë²„íŠ¼ í™œì„±í™”
  function checkAllAnswered(){
    const allAnswered = Array.from(document.querySelectorAll('.scale')).every(scale =>
      scale.querySelector('input:checked')
    );
    document.getElementById('nextBtn').disabled = !allAnswered;

    document.querySelectorAll('label.chip').forEach(l => {
      l.classList.toggle('selected', l.querySelector('input').checked);
    });
  }

  // 3ï¸âƒ£ PID í™•ì¸
  const qs = new URLSearchParams(location.search);
  const pid = qs.get('pid') || localStorage.getItem('exp_pid') || '';
  if(document.getElementById('body')) document.getElementById('body').textContent = text;

  // 4ï¸âƒ£ ë”ë¯¸ ì§€í‘œ
  const counts = (() => {
    const save = 20 + Math.floor(Math.random()*20);
    const comment = save + Math.floor(Math.random()*80);
    const like = comment + Math.floor(Math.random()*200);
    const share = Math.min(2000, like + Math.floor(Math.random()*400));
    return {share, like, comment, save};
  })();
  if(document.getElementById('shareCnt')) document.getElementById('shareCnt').textContent = counts.share.toLocaleString();
  if(document.getElementById('likeCnt')) document.getElementById('likeCnt').textContent = counts.like.toLocaleString();
  if(document.getElementById('commentCnt')) document.getElementById('commentCnt').textContent = counts.comment.toLocaleString();
  if(document.getElementById('saveCnt')) document.getElementById('saveCnt').textContent = counts.save.toLocaleString();

  // 5ï¸âƒ£ Firestore ì €ì¥ í•¨ìˆ˜
  async function saveToFirestore(answers){
    if(!pid) return;
    try{
      await addDoc(collection(db, "responses"), {
        pid,
        page: PAGE,
        answers,
        timestamp: new Date()
      });
      console.log("âœ… Firestore ì €ì¥ ì™„ë£Œ (page 10)");
    }catch(e){
      console.error("âŒ Firestore ì €ì¥ ì‹¤íŒ¨:", e);
    }
  }

  // 6ï¸âƒ£ í˜ì´ì§€ ë…¸ì¶œ ê¸°ë¡
  saveToFirestore([
    { key: 'P9_STIM_KEY', value: STIM_KEY },
    { key: 'P9_SHOWN_MS', value: String(DISPLAY_MS) }
  ]);

  // 7ï¸âƒ£ ì§„í–‰ë°” & íƒ€ì´ë¨¸
  const bar = document.getElementById('bar');
  let elapsed = 0;
  const interval = setInterval(()=>{
    elapsed += 1000;
    if(bar) bar.style.width = Math.min(100, (elapsed / DISPLAY_MS) * 100) + "%";
    if (elapsed >= DISPLAY_MS) {
      clearInterval(interval);
      redirect();
    }
  }, 1000);

 // 8ï¸âƒ£ ì•ˆì „í•œ ë¦¬ë””ë ‰ì…˜
async function redirect(){
  try{
    await saveToFirestore([]);
    await new Promise(r => setTimeout(r, 200));
  }catch(e){ console.warn(e); }

  location.href = `${NEXT_PAGE_URL}?pid=${encodeURIComponent(pid)}`;
}

// ğŸ”¹ ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
const nextBtn = document.getElementById('nextBtn');
nextBtn.addEventListener('click', redirect);

});
</script>


</body>
</html>
