<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì†Œì…œ ë¯¸ë””ì–´ ì—°êµ¬_p3</title>
<style>
  :root{--line:#e5e7eb;--pri:#2563eb;--muted:#6b7280}
  *{box-sizing:border-box}
  body{margin:0;background:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;color:#111827;line-height:1.6}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:12px;text-align:center;font-weight:700}
  main{max-width:880px;margin:0 auto;padding:18px}
  h1{font-size:20px;margin:6px 0 12px}
  .card{border:1px solid var(--line);border-radius:12px;padding:16px}
  .q{border-top:1px dashed var(--line);padding-top:12px;margin-top:12px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .field{display:flex;align-items:center;gap:8px}
  .name-row{display:flex;align-items:flex-end;gap:16px;flex-wrap:wrap;margin-top:12px}
  .name-field{display:flex;align-items:center;gap:8px}
  input[type="text"]{border:1px solid var(--line);border-radius:10px;padding:8px 10px}
  .note{font-size:12px;color:var(--muted)}
  .contact{margin-top:10px;font-size:14px}
  .footer {margin-top: 20px;text-align: center;}
  .btn {border: none;border-radius: 10px;padding: 12px 18px;font-size: 16px;background: var(--pri);color: #fff;font-weight: 600;cursor: pointer;transition: background .2s, transform .1s;}
  .btn:hover:not(:disabled) {background: #1d4ed8;transform: translateY(-1px);}
  .btn:disabled {opacity: .5;cursor: not-allowed;}
</style>
</head>
<body>
<header>ì—°êµ¬ ë™ì˜ì„œ</header>
<main>
  <section class="card">
    <p>ë³¸ì¸ì€ ë³¸ ì—°êµ¬ì™€ ê´€ë ¨ëœ ì¶©ë¶„í•œ ì„¤ëª…ì„ ì½ê³  ì´í•´í•˜ì˜€ìœ¼ë©°, ì¶©ë¶„í•œ ì‹œê°„ì„ ê°–ê³  ìƒê°í•œ ì´í›„ì— ìƒê¸° ì—°êµ¬ì— ì°¸ì—¬í•˜ê¸°ë¥¼ ìë°œì ì¸ ì˜ì‚¬ì— ì˜í•˜ì—¬ ë™ì˜í•©ë‹ˆë‹¤. ë³¸ì¸ì€ ì„¤ë¬¸ì— ì‘ë‹µí•˜ê±°ë‚˜ ê³¼ì œë¥¼ ìˆ˜í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ ë„ì¤‘ì— ê·¸ë§Œë‘ê¸°ë¥¼ ì›í•œë‹¤ë©´ ì–¸ì œë“ ì§€ ê·¸ë§Œë‘˜ ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ì´í•´í•˜ê³ , ì´ë•ŒëŠ” ê´€ë ¨ëœ ì •ë³´ê°€ ëª¨ë‘ íŒŒê¸°ë¨ì„ ìˆ™ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>

    <div class="q">
      <div>1. ë³¸ì¸ì€ ë³¸ ì—°êµ¬ì— ëŒ€í•œ ì„¤ëª…ì„ ì´í•´í•˜ì…¨ìŠµë‹ˆê¹Œ?</div>
      <div class="row" role="radiogroup" aria-label="ë¬¸í•­1">
        <label class="field"><input type="radio" name="q1" value="ì˜ˆ"> ì˜ˆ</label>
        <label class="field"><input type="radio" name="q1" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
      </div>
    </div>

    <div class="q">
      <div>2. ë³¸ì¸ì€ ì—°êµ¬ì˜ ìœ„í—˜ê³¼ ì´ë“ì— ëŒ€í•˜ì—¬ ì´í•´í•˜ì…¨ìŠµë‹ˆê¹Œ?</div>
      <div class="row" role="radiogroup" aria-label="ë¬¸í•­2">
        <label class="field"><input type="radio" name="q2" value="ì˜ˆ"> ì˜ˆ</label>
        <label class="field"><input type="radio" name="q2" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
      </div>
    </div>

    <div class="q">
      <div>3. ë³¸ì¸ì€ ì—°êµ¬ ì§„í–‰ ì¤‘ ì–¸ì œë“ ì§€ ì–´ë– í•œ ë¶ˆì´ìµ ì—†ì´ ì—°êµ¬ì˜ ì°¸ì—¬ë¥¼ ì² íšŒí•  ìˆ˜ ìˆìŒì„ ì´í•´í•˜ì…¨ìŠµë‹ˆê¹Œ?</div>
      <div class="row" role="radiogroup" aria-label="ë¬¸í•­3">
        <label class="field"><input type="radio" name="q3" value="ì˜ˆ"> ì˜ˆ</label>
        <label class="field"><input type="radio" name="q3" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
      </div>
    </div>

    <div class="q">
      <div>4. ë³¸ì¸ì€ ë³¸ ì—°êµ¬ì— ìë°œì ì¸ ì˜ì‚¬ì— ì˜í•˜ì—¬ ì°¸ì—¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
      <div class="row" role="radiogroup" aria-label="ë¬¸í•­4">
        <label class="field"><input type="radio" name="q4" value="ì˜ˆ"> ì˜ˆ</label>
        <label class="field"><input type="radio" name="q4" value="ì•„ë‹ˆì˜¤"> ì•„ë‹ˆì˜¤</label>
      </div>
    </div>

    <div class="q">
      <div class="name-row">
        <div class="name-field">
          <label for="pname">ì°¸ì—¬ì ì„±ëª…:</label>
          <input id="pname" type="text" placeholder="ì„±ëª… ì…ë ¥" autocomplete="off" />
        </div>
        <div class="name-field">
          <span>ì—°êµ¬ì ì„±ëª…: ë‚¨ê¸°ì—°</span>
        </div>
      </div>

      <div class="contact">
        â–  ì—°êµ¬ë‹´ë‹¹ì: ì¤‘ì•™ëŒ€í•™êµ ì„ì‚¬ê³¼ì • ë‚¨ê¸°ì—° (TEL: 010-5001-2418, kybell@kakao.com)<br/>
        â–  ì§€ë„êµìˆ˜: ì¤‘ì•™ëŒ€í•™êµ ì‹¬ë¦¬í•™ê³¼ êµìˆ˜ í˜„ëª…í˜¸<br/>
        ì¤‘ì•™ëŒ€í•™êµ êµì–‘ëŒ€í•™ êµìˆ˜ ê¶Œì˜ì‹¤<br/>
        â–  ì¤‘ì•™ëŒ€í•™êµ ìƒëª…ìœ¤ë¦¬ ìœ„ì›íšŒ (TEL: 02-820-6346, ethics@cau.ac.kr)
      </div>
    </div>

    <div class="footer">
      <button id="nextBtn" class="btn" disabled>ë‹¤ìŒ</button>
    </div>
  </section>
</main>

<script type="module">
  // âœ… Firebase SDK ë¶ˆëŸ¬ì˜¤ê¸°
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  // âœ… Firebase ì„¤ì • (ë³¸ì¸ í”„ë¡œì íŠ¸ ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
  const firebaseConfig = {
    apiKey: "AIzaSyCEZEZItyfBTMg8tVWv3RQX19r6R-71pME",
    authDomain: "to-be-a-master.firebaseapp.com",
    projectId: "to-be-a-master",
    storageBucket: "to-be-a-master.firebasestorage.app",
    messagingSenderId: "223906864735",
    appId: "1:223906864735:web:a04b3fdfa88e48a99905ea",
    measurementId: "G-SXF1BMH4DB"
  };

  // âœ… Firebase & Firestore ì´ˆê¸°í™”
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  document.addEventListener('DOMContentLoaded', () => {
    const PAGE = 3;
    const NEXT_PAGE_URL = "page4.html";

    const qs = new URLSearchParams(location.search);
    const pid = qs.get('pid') || localStorage.getItem('exp_pid') || '';
    const nextBtn = document.getElementById('nextBtn');
    const pname = document.getElementById('pname');
    const qNames = ['q1', 'q2', 'q3', 'q4'];

    function getAnswers() {
      const out = {};
      for (const n of qNames) {
        const v = (document.querySelector(`input[name="${n}"]:checked`) || {}).value || null;
        out[n] = v;
      }
      return out;
    }

    function allYes(ans) {
      return ans.q1 === 'ì˜ˆ' && ans.q2 === 'ì˜ˆ' && ans.q3 === 'ì˜ˆ' && ans.q4 === 'ì˜ˆ';
    }

    function syncState() {
      const ans = getAnswers();
      nextBtn.disabled = !(allYes(ans) && pname.value.trim());
    }

    document.querySelectorAll('input[type="radio"]').forEach(el => el.addEventListener('change', syncState));
    pname.addEventListener('input', syncState);

    // âœ… Firestoreì— ë°ì´í„° ì €ì¥ í•¨ìˆ˜
    async function saveToFirestore(data) {
      try {
        await addDoc(collection(db, "responses"), data);
        console.log("âœ… Firestore ì €ì¥ ì„±ê³µ");
      } catch (e) {
        console.error("âŒ Firestore ì €ì¥ ì‹¤íŒ¨:", e);
        throw e;
      }
    }

    nextBtn.addEventListener('click', async () => {
  const ans = getAnswers();
  if (!allYes(ans)) return;
  const name = pname.value.trim();

  // ğŸ”¹ ë°°ì—´ êµ¬ì¡°ë¡œ ì €ì¥
  const answersArray = [
    { question: "ë³¸ ì—°êµ¬ì— ëŒ€í•œ ì„¤ëª… ì´í•´", answer: ans.q1 },
    { question: "ì—°êµ¬ ìœ„í—˜ê³¼ ì´ë“ ì´í•´", answer: ans.q2 },
    { question: "ì—°êµ¬ ì°¸ì—¬ ì² íšŒ ê°€ëŠ¥ ì´í•´", answer: ans.q3 },
    { question: "ìë°œì  ì°¸ì—¬ ì˜ì‚¬", answer: ans.q4 },
    { question: "ì°¸ì—¬ì ì„±ëª…", answer: name }
  ];

  const dataToSave = {
    pid,
    page: PAGE,
    answers: answersArray, // ë°°ì—´ í˜•íƒœ
    timestamp: new Date()
  };

  nextBtn.disabled = true; // ì¤‘ë³µ í´ë¦­ ë°©ì§€

  try {
    await saveToFirestore(dataToSave);

    // ì €ì¥ ì„±ê³µ ì‹œ ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
    location.href = `${NEXT_PAGE_URL}?pid=${encodeURIComponent(pid)}`;
  } catch (e) {
    console.warn('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', e);
    alert('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    nextBtn.disabled = false; // ì¬ì‹œë„ ê°€ëŠ¥
  }
});

</script>

</body>
</html>
